<html>
<head>
<script src="a.out.js"></script>
<script src="dat.gui.min.js"></script>
<script src="Debugging.js"></script>
</head>
<body>
    <table>
        <tr>
        <td><input type="text" id="numPerms" size="3"></input></td>
        <td>
        <button type="button" onclick="findGreedyPerm()" id="greedyPerm">Get Greedy Perm</button>
        </td>
        </tr>
    </table>

    <canvas id="segcanvas" width="600" height="600" style="border:1px solid #000000;">
    </canvas>

    <script type="text/javascript">
        let isCompiled = false;
        let points = []; // These are our points in Javascript
        let idxPerm = [];
        let distLandLand = null;
        let distLandData = null;
        let X = null; // These are our points in C++
        let distLandLandCheck = null;
        let distLandDataCheck = null;
        let numPermsInput = document.getElementById("numPerms");
        let canvas = document.getElementById("segcanvas");
        let ctx = canvas.getContext("2d");

        Module.onRuntimeInitialized = function () {
            isCompiled = true;
            distLandLand = new Module.VectorFloat();
            distLandData = new Module.VectorVectorFloat();
            X = new Module.VectorVectorFloat();
            distLandDataCheck = new Module.VectorVectorFloat();
            distLandLandCheck = new Module.VectorFloat();
        }

        function repaint() {
            let dW = 5;
            let W = canvas.width;
            let H = canvas.height;
            ctx.clearRect(0, 0, W, H);
            ctx.fillStyle = "#000000";
            for (let i = 0; i < points.length; i++) {
                let x = points[i][0];
                let y = points[i][1];
                ctx.fillRect(x, y, dW, dW);
            }
            ctx.fillStyle = "#ff0000";
            dW = 10;
            for (let i = 0; i < idxPerm.length; i++) {
                let x = points[idxPerm[i]][0];
                let y = points[idxPerm[i]][1];
                ctx.fillRect(x, y, dW, dW);
            }
        }

        function getMousePosition(canvas, event) {
            let rect = canvas.getBoundingClientRect();
            let x = event.clientX - rect.left;
            let y = event.clientY - rect.top;
            points.push([x, y]);
            repaint();
        }

        let canvasElem = document.querySelector("canvas");

        canvasElem.addEventListener("mousedown", function (e) {
            getMousePosition(canvasElem, e);
        });

        function findGreedyPerm() {
            if (isCompiled) {
                Module.clearVector(distLandLand);
                Module.clearVectorVector(distLandData);
                Module.clearVectorVector(X);
                for (let i = 0; i < points.length; i++) {
                    let x = new Module.VectorFloat();
                    for (let j = 0; j < points[i].length; j++) {
                        x.push_back(points[i][j]);
                    }
                    X.push_back(x);
                }
                let k = parseInt(numPermsInput.value);
                k = Math.min(k, points.length);
                console.log(k);
                let perm = new Module.getGreedyPerm(X, k, distLandLand, distLandData);
                idxPerm.length = 0;
                for (let i = 0; i < k; i++) {
                    idxPerm.push(perm.get(i));
                }
                repaint();
            }
            else {
                alert("Not Compiled Yet");
            }
        }


    </script>

</body>
</html>